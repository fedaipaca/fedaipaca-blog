---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection, getEntry, render } from "astro:content";
import { Image } from "astro:assets";

export async function getStaticPaths() {
  const posts = await getCollection("blog", ({ data }) => !data.isDraft);
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

const formattedDate = post.data.pubDate
  ? new Date(post.data.pubDate).toLocaleString("en-US", { month: "short", day: "numeric", year: "numeric" })
  : undefined;
---

<BaseLayout title={post.data.title}>
  <!-- post -->
  <article class="min-w-full prose prose-lg py-10">
    <header class="">
      <h1 class="mb-0">{post.data.title}</h1>
      <div class="mt-4 flex items-center gap-4 font-mono tracking-tight text-neutral-600 text-sm">
        {
          formattedDate ? (
            <time datetime={new Date(post.data.pubDate).toISOString()} class="text-nowrap ">
              {formattedDate}
            </time>
          ) : null
        }

        {
          post.data.tags ? (
            <div class="flex flex-wrap gap-2">
              {post.data.tags.map((tag) => (
                <span class="px-2">#{tag}</span>
              ))}
            </div>
          ) : null
        }
      </div>

      {
        post.data.image && (
          <figure class="">
            <Image src={post.data.image.src} alt={post.data.image.alt} class="w-full rounded aspect-4/3 object-cover" />
          </figure>
        )
      }
    </header>

    <Content />
  </article>

  <!-- post end -->
</BaseLayout>
